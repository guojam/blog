<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于 Promise | Jam&#39;s blog</title>
    <meta name="description" content="
catch

promise
then / catch 方法 ，都返回一个新的 promise 对象
catch 为 then 的语法糖，它是 then(null, rejection)的别名。
也就是说，catch 也是 then，它用于捕获错误，它的参数也就是 then 的第二个参数。

then/catch 里的 return 值 作为之后执行的 then/catch 的参数
 ...">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.06eee1e4.css" as="style"><link rel="preload" href="/blog/assets/js/app.c68185d2.js" as="script"><link rel="preload" href="/blog/assets/js/6.208dbb32.js" as="script"><link rel="preload" href="/blog/assets/js/4.bd116204.js" as="script"><link rel="preload" href="/blog/assets/js/17.5489a10f.js" as="script"><link rel="prefetch" href="/blog/assets/js/1.83070e30.js"><link rel="prefetch" href="/blog/assets/js/10.2b6e9132.js"><link rel="prefetch" href="/blog/assets/js/11.472170bb.js"><link rel="prefetch" href="/blog/assets/js/12.47e0aaee.js"><link rel="prefetch" href="/blog/assets/js/13.117ff703.js"><link rel="prefetch" href="/blog/assets/js/14.c617a9ec.js"><link rel="prefetch" href="/blog/assets/js/15.c0896ac2.js"><link rel="prefetch" href="/blog/assets/js/16.3d83079c.js"><link rel="prefetch" href="/blog/assets/js/18.4ba9fcc5.js"><link rel="prefetch" href="/blog/assets/js/19.2863657b.js"><link rel="prefetch" href="/blog/assets/js/20.d2043ed0.js"><link rel="prefetch" href="/blog/assets/js/21.f0052576.js"><link rel="prefetch" href="/blog/assets/js/5.44052d43.js"><link rel="prefetch" href="/blog/assets/js/7.9bf5a85f.js"><link rel="prefetch" href="/blog/assets/js/8.50a46eb7.js"><link rel="prefetch" href="/blog/assets/js/9.f7621bfb.js"><link rel="prefetch" href="/blog/assets/js/vuejs-paginate.04bf6230.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.06eee1e4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/blog/" class="nav-link home-link">Jam's blog</a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/blog/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/blog/" class="nav-link mobile-home-link">Jam's blog</a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/blog/tag/" class="nav-link">Tags</a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title"></h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">guojam</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2019-07-08T00:00:00.000Z">
      2019-07-08
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-52d6caad><a href="/blog/tag/Promise" data-v-52d6caad>Promise</a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="关于-promise"><a href="#关于-promise" class="header-anchor">#</a> 关于 Promise</h1> <h2 id="catch"><a href="#catch" class="header-anchor">#</a> catch</h2> <p>promise
then / catch 方法 ，都返回一个新的 promise 对象
catch 为 then 的语法糖，它是 then(null, rejection)的别名。
也就是说，catch 也是 then，它用于捕获错误，它的参数也就是 then 的第二个参数。</p> <p>then/catch 里的 return 值 作为之后执行的 then/catch 的参数</p> <h3 id="catch-与-then-null-并非完全等价"><a href="#catch-与-then-null-并非完全等价" class="header-anchor">#</a> catch() 与 then(null, ...) 并非完全等价</h3> <p>then(resolveHandler, rejectHandler) 这种形式
catch 能捕获 resolveHandler 引发的异常，而 rejectHandler 不能。</p> <h2 id="promise-值穿透"><a href="#promise-值穿透" class="header-anchor">#</a> promise 值穿透</h2> <p>.then 或者 .catch 的参数期望是函数，传入非函数则会发生值穿透</p> <p>MDN 上关于 then 参数的说明:
如果忽略针对某个状态的回调函数参数，或者提供非函数 (nonfunction) 参数，那么 then 方法将会丢失关于该状态的回调函数信息，但是并不会产生错误。如果调用 then 的 Promise 的状态（fulfillment 或 rejection）发生改变，但是 then 中并没有关于这种状态的回调函数，那么 then 将创建一个没有经过回调函数处理的新 Promise 对象，<strong><em>这个新 Promise 只是简单地接受调用这个 then 的原 Promise 的终态作为它的终态</em></strong>。</p> <ul><li>onFulfilled 可选
当 Promise 变成接受状态（fulfilled）时调用的函数。该函数有一个参数，即接受的最终结果（the fulfillment value）。如果该参数不是函数，则会在内部被替换为 (x) =&gt; x，即原样返回 promise 最终结果的函数</li> <li>onRejected 可选
当 Promise 变成拒绝状态（rejected）时调用的函数。该函数有一个参数，即拒绝的原因（rejection reason）。 如果该参数不是函数，则会在内部被替换为一个 &quot;Thrower&quot; 函数 (it throws an error it received as argument)</li></ul> <h2 id="promise-哪些-api-涉及了微任务？"><a href="#promise-哪些-api-涉及了微任务？" class="header-anchor">#</a> Promise 哪些 API 涉及了微任务？</h2> <p>构造 Promise 时，exectuor 作为参数传给 Promise 的构造函数同步执行。
状态变更后被执行的回调放在微任务队列。
比如说 then、 catch 、finally。调用这些方法时，</p> <ul><li>如果 Promise 处于 pending 状态，这些方法的回调函数会加到 promise 的 [[PromiseFulfillReactions]]/[[PromiseRejectReactions]] 列表里成为最后一项，待 Promise 状态变为 fulfilled 后，将该列表中的每一项加入微任务队列</li> <li>如果 Promise 处于 fulfilled 状态， 回调会直接放入微任务队列</li></ul> <h2 id="promise-与-observable-区别"><a href="#promise-与-observable-区别" class="header-anchor">#</a> promise 与 observable 区别</h2> <p><a href="https://zhuanlan.zhihu.com/p/20531896" target="_blank" rel="noopener noreferrer">不要把 Rx 用成 Promise<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>observables 是 lazy evaluation
无论是否调用 then，promise 都会被立即执行；而 observables 却只是被创建，并不会执行，只有在真正需要结果的时候才会被执行</li> <li>observable 能够在执行前或者执行过程中被 cancel，或者叫做 dispose。</li> <li>对于 promise，不论怎么调用 then，实际上的异步操作只会被执行一次，多次调用没有效果；但是对于 observable，多次调用 forEach 或者使用 retry 方法，能够触发多次异步操作。</li> <li>observable 可以进行组合变换。observable 可以看做列表，可以进行各种组合变换，即 LINQ 操作，比如 merge，zip，map，sum 等等。这是 observable 相对于 promise 的一大优势。</li></ol></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#catch" title="catch">catch</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#catch-与-then-null-并非完全等价" title="catch() 与 then(null, ...) 并非完全等价">catch() 与 then(null, ...) 并非完全等价</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#promise-值穿透" title="promise 值穿透">promise 值穿透</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#promise-哪些-api-涉及了微任务？" title="Promise 哪些 API 涉及了微任务？">Promise 哪些 API 涉及了微任务？</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#promise-与-observable-区别" title="promise 与 observable 区别">promise 与 observable 区别</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://github.com/guojam" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-fdbf4940><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-fdbf4940></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="https://policies.google.com/privacy?hl=en-US" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940>Privacy Policy</a></li><li class="copyright-item" data-v-fdbf4940><a href="/blog/2019/07/08/all-about-promise/.html" class="nav-link" data-v-fdbf4940>MIT Licensed | Copyright © 2020-present Vue.js</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.c68185d2.js" defer></script><script src="/blog/assets/js/6.208dbb32.js" defer></script><script src="/blog/assets/js/4.bd116204.js" defer></script><script src="/blog/assets/js/17.5489a10f.js" defer></script>
  </body>
</html>
